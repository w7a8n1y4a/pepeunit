# Backend

::::warning
Manual editing is usually not required; you typically only need to fill in the main variables because there is a [file that generates .env files for services](/en/deployment/docker/deploy#filling-the-primary-env-file).
::::

Variable | Default | Purpose
-- | -- | --
`PU_FF_TELEGRAM_BOT_ENABLE` | `True` | Feature flag that controls whether the [Telegram Bot](/en/definitions#telegram-bot) is enabled
`PU_FF_GRAFANA_INTEGRATION_ENABLE` | `True` | Feature flag that controls whether integration with `Grafana` is enabled
`PU_FF_DATAPIPE_DEFAULT_LAST_VALUE_ENABLE` | `True` | Feature flag that controls whether [DataPipe](/en/deployment/dependencies/datapipe) of type [LastValue](/en/user/datapipe/example#lastvalue) is created by default for each [UnitNode](/en/definitions#unitnode)
`PU_FF_DATAPIPE_ENABLE` | `True` | Feature flag that controls whether [DataPipe](/en/deployment/dependencies/datapipe) capabilities are enabled. When disabled, you should also stop the [DataPipe](/en/deployment/dependencies/datapipe) service, as it will no longer receive configuration updates, etc.
`PU_FF_PROMETHEUS_ENABLE` | `True` | Feature flag that controls whether monitoring of requests via [Prometheus](/en/deployment/dependencies/prometheus) is enabled
`PU_LOG_FORMAT` | `json` | Log format. In `json` mode, each log record is a single `dict`. In `plain` mode, logs are standard text lines, but `traceback` is written line by line
`PU_MIN_LOG_LEVEL` | `INFO` | Minimum log level output to the console. Logs below this level are not shown. Allowed values: `DEBUG`, `INFO`, `WARNING`, `ERROR`, `CRITICAL`
`PU_APP_PREFIX` | `/pepeunit` | Standard prefix used to separate app paths from the domain; usually does not need changes. Useful for complex embedded setups
`PU_API_V1_PREFIX` | `/api/v1` | Prefix for [REST API](/en/definitions#rest) version. Allows supporting old [REST API](/en/definitions#rest) versions and multiple versions simultaneously
`PU_WORKER_COUNT` | `2` | Number of Gunicorn workers; increases the load that the [Backend](/en/deployment/dependencies/backend) can handle
`PU_DOMAIN` | - | Domain name or IP. Affects links generated by the [Backend](/en/deployment/dependencies/backend) and allows [Unit](/en/definitions#unit) to connect to the [Backend](/en/deployment/dependencies/backend). Propagated to [Unit ENV](/en/developer/files/struct-env-example-json) as `PU_DOMAIN`
`PU_SECURE` | `True` | If `True`, the [Backend](/en/deployment/dependencies/backend) generates `https` links for `PU_DOMAIN`. Propagated to [Unit ENV](/en/developer/files/struct-env-example-json) field `PU_HTTP_TYPE` as `https/http`
`PU_AUTH_TOKEN_EXPIRATION` | `2678400` | Lifetime of user auth tokens, in seconds
`PU_SAVE_REPO_PATH` | `repo_cache` | Path where the [Backend](/en/deployment/dependencies/backend) stores external [Git](/en/definitions#git) repositories, relative to the Backend root directory
`PU_SQLALCHEMY_DATABASE_URL` | - | Connection URL for [PostgreSQL](/en/deployment/dependencies/postgresql)
`PU_CLICKHOUSE_DATABASE_URL` | - | Connection URL for [ClickHouse](/en/deployment/dependencies/clickhouse)
`PU_SECRET_KEY` | - | `32‑byte key` in `base64` format. Used to sign auth tokens. If changed, all previously issued `jwt` tokens become invalid
`PU_ENCRYPT_KEY` | - | `32‑byte key` in `base64` format. Used to encrypt all data. If changed, all previously encrypted records become impossible to decrypt
`PU_STATIC_SALT` | - | `32‑byte key` in `base64` format. Used to generate password `hash` values for [Users](/en/development-pepeunit/mechanics/roles#user). If changed, all accounts created before the change will no longer be able to authenticate
`PU_MIN_INTERVAL_SYNC_REPOSITORY` | `10` | Minimum time in seconds before the next repository update request to an external source
`PU_STATE_SEND_INTERVAL` | `60` | Interval in seconds at which [Units](/en/definitions#unit) should send their state. Propagated to [Unit ENV](/en/developer/files/struct-env-example-json) as `STATE_SEND_INTERVAL`
`PU_MAX_EXTERNAL_REPO_SIZE` | `50` | Limit in MB for the size of external [Git](/en/definitions#git) repositories that can be downloaded
`PU_MAX_CIPHER_LENGTH` | `1000000` | Maximum length in characters for encrypted data
`PU_MIN_TOPIC_UPDATE_TIME` | `30` | Update interval for messages in `domain.com/+/pepeunit` [MQTT](/en/definitions#mqtt) topics, in seconds
`PU_UNIT_LOG_EXPIRATION` | `86400` | Lifetime in seconds of logs sent by [Unit](/en/definitions#unit)
`PU_MAX_PAGINATION_SIZE` | `500` | Maximum number of objects that can be returned in a single request where pagination is used
`PU_TELEGRAM_BOT_MODE` | `webhook` | Accepts `webhook` or `pooling`. Defines how the [Backend](/en/deployment/dependencies/backend) communicates with the [Telegram Bot](/en/definitions#telegram-bot). `pooling` works without a personal domain and `https` in environments with internet access. `webhook` is more performant and intended for `https` and a personal domain; the webhook URL is set automatically on startup
`PU_TELEGRAM_DEL_OLD_WEBHOOK` | `True` | Whether to delete the existing `webhook` for the [Telegram Bot](/en/definitions#telegram-bot) before creating a new one
`PU_TELEGRAM_TOKEN` | - | [Telegram Bot](/en/definitions#telegram-bot) token. Secret – do not share it
`PU_TELEGRAM_BOT_LINK` | - | Link to the [Telegram Bot](/en/definitions#telegram-bot) managed by the [Backend](/en/deployment/dependencies/backend). Used to generate verification links for [Users](/en/development-pepeunit/mechanics/roles#user). Exposed in `openapi.json`
`PU_TELEGRAM_ITEMS_PER_PAGE` | `7` | Number of items per page in the [Telegram Bot](/en/definitions#telegram-bot) UI
`PU_TELEGRAM_HEADER_ENTITY_LENGTH` | `15` | Maximum length of entity names shown in the [Telegram Bot](/en/definitions#telegram-bot)
`PU_TELEGRAM_GIT_HASH_LENGTH` | `8` | Maximum length of [Git Commit](/en/definitions#git-commit) `hash` shown in the [Telegram Bot](/en/definitions#telegram-bot)
`PU_PROMETHEUS_MULTIPROC_DIR` | `./prometheus_metrics` | Directory used by [Prometheus](/en/deployment/dependencies/prometheus) to store metrics from multiple `uvicorn` workers. Cleared on application startup
`PU_REDIS_URL` | `redis://redis:6379/0` | [Redis](/en/deployment/dependencies/redis) connection URL used by the [Backend](/en/deployment/dependencies/backend). The [Redis](/en/deployment/dependencies/redis) instance must be the same as for `MQTT_REDIS_AUTH_URL`
`PU_MQTT_HOST` | - | Domain name or IP used by the [Backend](/en/deployment/dependencies/backend) to manage and subscribe to [EMQX](/en/deployment/dependencies/emqx) topics, and by Unit to connect to [EMQX](/en/deployment/dependencies/emqx). Propagated to [Unit ENV](/en/developer/files/struct-env-example-json) as `PU_MQTT_HOST`
`PU_MQTT_SECURE` | `True` | If `True`, the [Backend](/en/deployment/dependencies/backend) uses `https` to configure [EMQX](/en/deployment/dependencies/emqx)
`PU_MQTT_PORT` | `1883` | Port used by [Unit](/en/definitions#unit) and [Backend](/en/deployment/dependencies/backend) to connect to [EMQX](/en/deployment/dependencies/emqx). Propagated to [Unit ENV](/en/developer/files/struct-env-example-json) as `PU_MQTT_PORT`
`PU_MQTT_API_PORT` | `18083` | [EMQX](/en/deployment/dependencies/emqx) [API](/en/definitions#api) port used by the [Backend](/en/deployment/dependencies/backend) to configure [EMQX](/en/deployment/dependencies/emqx)
`PU_MQTT_KEEPALIVE` | `60` | Maximum period in seconds between `ping` messages from the [Backend](/en/deployment/dependencies/backend) to [EMQX](/en/deployment/dependencies/emqx)
`PU_MQTT_USERNAME` | - | [EMQX](/en/deployment/dependencies/emqx) username used by the [Backend](/en/deployment/dependencies/backend) for initial broker setup
`PU_MQTT_PASSWORD` | - | [EMQX](/en/deployment/dependencies/emqx) password used by the [Backend](/en/deployment/dependencies/backend) for initial broker setup
`PU_MQTT_REDIS_AUTH_URL` | `redis://redis:6379/0` | [Redis](/en/deployment/dependencies/redis) connection URL used by [EMQX](/en/deployment/dependencies/emqx) to connect to [Redis](/en/deployment/dependencies/redis). The [Redis](/en/deployment/dependencies/redis) instance must be the same as `REDIS_URL`
`PU_MQTT_MAX_CLIENTS` | `10000` | Maximum number of [EMQX](/en/deployment/dependencies/emqx) clients
`PU_MQTT_MAX_CLIENT_CONNECTION_RATE` | `20/s` | Maximum connection rate for [EMQX](/en/deployment/dependencies/emqx) clients
`PU_MQTT_MAX_CLIENT_ID_LEN` | `512` | Maximum client ID length in [EMQX](/en/deployment/dependencies/emqx)
`PU_MQTT_CLIENT_MAX_MESSAGES_RATE` | `30/s` | Maximum message rate for a single [EMQX](/en/deployment/dependencies/emqx) client
`PU_MQTT_CLIENT_MAX_BYTES_RATE` | `1MB/s` | Maximum connection throughput for an [EMQX](/en/deployment/dependencies/emqx) client
`PU_MQTT_MAX_PAYLOAD_SIZE` | `256` | Maximum payload size in KB for data sent through [EMQX](/en/deployment/dependencies/emqx) topics
`PU_MQTT_MAX_QOS` | `2` | Maximum Quality of Service supported by [EMQX](/en/deployment/dependencies/emqx)
`PU_MQTT_MAX_TOPIC_LEVELS` | `5` | Maximum topic depth in [EMQX](/en/deployment/dependencies/emqx)
`PU_MQTT_MAX_LEN_MESSAGE_QUEUE` | `128` | Maximum queue length for [EMQX](/en/deployment/dependencies/emqx) messages
`PU_MQTT_MAX_TOPIC_ALIAS` | `128` | Maximum number of topic aliases in [EMQX](/en/deployment/dependencies/emqx)
`PU_GITHUB_TOKEN_NAME` | - | Name of a [GitHub](/en/definitions#github) token with read‑only access to public repositories. Increases the rate limit for downloading public repositories from [GitHub](/en/definitions#github) from `60` to `5000` per hour
`PU_GITHUB_TOKEN_PAT` | - | [GitHub](/en/definitions#github) token with read‑only access to public repositories; also increases the public repo download rate limit
`PU_GRAFANA_ADMIN_USER` | - | Admin login for [Grafana](/en/deployment/dependencies/grafana)
`PU_GRAFANA_ADMIN_PASSWORD` | - | Admin password for [Grafana](/en/deployment/dependencies/grafana)
`PU_GRAFANA_LIMIT_UNIT_NODE_PER_ONE_PANEL` | `10` | Maximum number of [UnitNode](/en/definitions#unitnode) per single [Visualization](/en/definitions#visualization)

::::info
For testing the [Backend](/en/deployment/dependencies/backend) there are also dedicated variables:
- [Integration testing variables](/en/development-pepeunit/tests/integration-test#run)
- [MQTT load testing variables](/en/development-pepeunit/tests/load-test#mqtt-testing)
- [REST and GQL load testing variables](/en/development-pepeunit/tests/load-test#rest-and-gql-testing)
::::

