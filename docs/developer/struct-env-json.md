# Структура env.json и env_example.json

## env_example.json
### структура
```json
{
    "WIFI_SSID": "My_Perfect_Wifi_SSID",
    "WIFI_PASS": "Strong_Password",
    "PUBLISH_SEND_INTERVAL": 10,
    "DUTY_MIN": 8192,
    "DUTY_MAX": 65535,
    "TEMP_MIN": 30,
    "TEMP_MAX": 60,
    "PEPEUNIT_URL": "unit.pepemoss.com",
    "HTTP_TYPE": "https",
    "MQTT_URL": "emqx.pepemoss.com",
    "PEPEUNIT_TOKEN": "jwt_token",
    "SYNC_ENCRYPT_KEY": "32_bit_encrypt_key",
    "SECRET_KEY": "32_bit_secret_key",
    "PING_INTERVAL": 30,
    "STATE_SEND_INTERVAL": 300
}
```

Переменные можно разделить на две категории - `зарезервированные` и `переменные разработчика`.

### Зарезервированные переменные Pepeunit

Pepeunit резервирует под нужды связи и стандартные процедуры следующий набор переменных окружения Unit:
- `PEPEUNIT_URL` - доменное имя или ip адрес инстанса Pepeunit. Полностью соответствует `BACKEND_DOMAIN` из .env файла Pepeunit
- `HTTP_TYPE` - тип соединения с доменным именем или адресом инстанса Pepeunit. Полностью соответствует `SECURE` из .env файла Pepeunit
- `MQTT_URL` - доменное имя или ip адресс инстанса EMQX MQTT Brocker. Полностью соответствует `MQTT_URL` из .env файла Pepeunit
- `PEPEUNIT_TOKEN` - jwt токен доступа для Unit на инстансе Pepeunit. Данный токен позволяет пройти авторизацию на публикацию и подписку у топиков EMQX MQTT Brocker
- `SYNC_ENCRYPT_KEY` - 16 битный ключ синхронного шифрования - уникальный для каждого Unit. Удобно использовать при шифровании чего-либо
- `SECRET_KEY` - 16 битный секретный ключ устройства - уникальный для каждого Unit
- `PING_INTERVAL` - частота MQTT пинга в секундах
- `STATE_SEND_INTERVAL` - частота отправки состояния в стандартный топик Pepeunit. Полностью соответствует `STATE_SEND_INTERVAL` из .env файла Pepeunit

### Переменные окружения разработчика Unit

Разработчик Unit может создавать любые переменные окружения, которые отличаются по названию от стандартных. При этом значения указанные в переменных, будут отображаться как значения по умолчанию в интерфейсе пользователей.

:::danger
Так как пользователь имеет возможность заполнять значение переменных окружения, очень желательно заполнить readme репозитория, который вы создаёте.
:::

:::warning Какое функциональное назначание у env_example.json?
Данный файл - это контракт между разработчиком Unit и Pepeunit:
1. Разработчик гарантирует, что он реализует в функционале Unit зарезервированные переменные Pepeunit, позволяющие взаимодействовать с Pepeunit
1. Pepeunit гарантирует возможность пользователей установить переменные указанные разработчиком
1. Pepeunit гарантирует что автоматически установит зарезервированные переменные указанные в файле при первом сохранении со стороны пользователя.
:::

:::info Пользовательский опыт
При первой попытке пользователя установить переменные окружения, он изначально видит только переменные которые добавил разработчик Unit через env_example.json.
:::

## env.json

Файлы окружения, такие как env.json или .env, представляют собой механизм индивидуализации общего кода под конкретное устройство или экземпляр приложения.

:::warning Какое функциональное назначание у env.json?
Данный файл - это четырёхсторонний контракт между Unit, Pepeunit, Пользователем и Администратором Инстанса Pepeunit:
1. Unit гарантирует всем сторонам, что будет использовать для соответствующих значений из env_example.json значения из env.json
1. Pepeunit гарантирует всем сторонам, что при первой установке переменных окружения в env.json, сгенерирует зарезервированные переменные
1. Pepeunit гарантирует всем сторонам, что Unit сможет пройти авторизацию для топиков и соединений в EMQX MQTT Brocker, авторизацию Backend с использованием `PEPEUNIT_TOKEN`
1. Pepeunit гарантирует всем сторонам, возможность изменения env.json
1. Pepeunit гарантирует всем сторонам, что env.json будет храниться в шифрованном виде
1. Pepeunit гарантирует всем сторонам, что доступ до env.json будет предоставлен только создателю Unit
1. Aдминистратор гарантирует всем сторонам, что env.json ни в каком виде не будет передан тем кто не явялется стороной данного контракта.
:::

::: danger
Используйте только доверенные инстансы Pepeunit. Следите, чтобы Администратор инстанса который вы используете, выполнял свои контрактные обязательства связанные с env.json.
:::

:::info Какие основные свойства можно выделить у env.json?
1. env.json файл секретен, его нельзя передавать кому-либо
1. env.json файл позволяет удобно конфигурировать и обновлять Unit
1. env.json файл позволяет Unit знать какому инстансу Pepeunit он принадлежит
1. env.json файл при помощи переменной PEPEUNIT_TOKEN позволяет Pepeunit производить авторизацию для конкретных Unit
:::