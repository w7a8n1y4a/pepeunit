# Структура сообщений в MQTT топиках

:::info
Сообщения через [MQTT](/definitions#mqtt) топики передаются в текстовом формате
:::

:::warning
Размер передаваемого [Unit](/definitions#unit) сообщения с префиксом `/pepeunit` на конце - ограничен количеством символов указанных в переменной окружения `MQTT_MAX_PAYLOAD_SIZE` из [Backend ENV](/deployment/env-variables#backend). По умолчанию это значение составляет `50000` символов.
:::


## Отправка единичного значения

1. Преобразовать значение переменной в текст
1. Передать значение фунции публикации

:::info Пример сигнатуры функции публикации
```python
def publish(topic: str, msg: str) -> None:
```
:::

В некоторых библиотеках или языках программирования может потребоваться дополнительное преобразование сообщения в `bytes` для корректной отправки

### DataPipe
Для простых сообщений текстом и числами, можно организовать обработку через [DataPipe](/definitions#datapipe). [Подробнее о настройке DataPipe](/user/data-pipe#datapipe)

## Отправка сложного сообщения

1. Преобразовать структуру данных в `json`
1. Преобразовать `json` в текст
1. Передать текст в функцию публикации

## Получение данных

При получении данных из топиков на которые [Unit](/definitions#unit) подписывается, достаточно просто совершить обратные преобразования. Главное обработать возможные ошибочные значения ввода в топик.

:::danger Почему важен обработчик ошибок?
Если [Unit](/definitions#unit) получит некорректные данные, он не должен перезагрузиться или выключиться. Для этого стоит добавлять обработчики ошибок преобразования типов, а так же валидаторы поступающих данных. В этих случаях [Unit](/definitions#unit) будет работать более предсказуемо для конечного [Пользователя](/mechanics/roles.html#user)
:::