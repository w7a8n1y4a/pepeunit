# Создаём IoT устройство способное к глобальному масштабированию

- статью переделать в как я решил свою личную проблему мб и вам поможет

## Пролог

Я увлекаюсь IoT уже более 7 лет, собрал множество устройств и программ для них: от gps логера для велосипеда и счётчика Гейгера с передачей данных, до делительных головок и муфельной печи с wifi управлением. Достаточно стандартный набор diy интузиаста.

В основном это устройства на платформах esp8266, esp32 и arduino. У всех этих подделок разный срок работы и судьба. Некоторые проработали 15 минут и сгорели, другие продержались до сегодняшнего дня, третие окислились на пол пути или вовсе утонули. Все эти устрйства были далеки от парадигм программирования, версионирования и масштабирования - они жёстко кодировали свои настройки. Нельзя себе представить ситуацию, в которой другой человек может использовать эти проекты себе во благо.

Посдовательность моего пути в IoT выглядела примерно так:

1. Получил понимание работы с микроконтроллерами в Arduino IDE
1. Дорос до VS Code в сочетании с Platformio
1. Примерно в то же время понял что без Git для контроля версий - никуда
1. Перешёл на Micropython для ускорения разработки

В начале пути каждый раз приступая к новому устройству меня ждало несколько дней или недель в обнимку с поисковиком, доскональному изучению тематических форумов и анализа видео. Мне нужно было только одно, интеграция переферии в мой код. И хотя поиск github сильно облегчал эту задачу, обычно на специфичные датчики или драйвера моторов, очень повезёт если найдётся хотябы 1 упоминание. В альтернативном случае придётся самому создавать программу для интеграции устройства, разбирая даташит.

Попытки совместить в голове программную часть и физическую, иногда приводили к полному сгоранию послденей. Зачастую эти причины были связаны с отсутствием схем подключения или разными напряжениями. Очень редко можно найти хороший репозиторий, который спасёт тебя от описанных участей, а найти репозиторий в котором есть схема подключений, это чудо.

Также стоит отметить, что почти все репозитории для IoT используются другими пользователями, только с целью раздербанить их на составляющие и использовать эти маленькие кусочки в своём коде. Это связано с двумя аспектами:
1. Все настройки захардкожены
2. Одно устройство имеет очень большую зону ответственности

Разработчиков IoT можно в целом разделить на три лагеря:
1. Новички - уже умеет писать рабочие программы, которые выполняют свои задачи
2. Энтузиаст - использует git, умеет пользоваться поиском github, может решить почти любую задачу, но библиотеку по даташиту на датчик ещё не напишет или напишет, но убъёт на это месяц
3. Профи - серьёзные ребята, напишут вам библиотеку на любой датчик по даташиту или просто из головы, они умеют предоставить гарантии по работе своих программ, в основном они либо работают в сфере IoT и в опенсорс выкладывают библиотеки, которыми активно пользуются новички и энтузиасты или создают исключительно устройства для продажи

Схема проста, новички учатся на примерах репозиториев от энтузиастов, а профи пишут библиотеки для новичков и энтузиастов

Что можно предпринять, чтобы ускорить прогресc IoT индустрии с открытым кодом?

Как мне кажется энтузиастам не хватает ПО, которое бы позволяло организовывать их устройства, в единые управляемые системы, по аналогии как делают на серьёзных производствах с контроллерами промышленного уровня Siemens, Mitsubishi и тд. В промышленном мире очень серьёзные гарантии исполнения, дублирование оборудования и системы отката процессов. Обычно такие системы имеют тяжёлые самописные или глубоко интегрированные SKADA системы, они стоят на атомных реакторах и почти на любом серьёзном производстве, где важен настоящий realtime, чтобы соответствовать уровню надёжности системы обычно работа идёт в 3 смены с дублирующими коллективами.

В то же время максимум гарантий который обычно есть у энтузиаста - это перезагрузка в случае потери питания, переподключение к wifi и брокеру, обработка ошибочных значений. Даже этот минимальный минимум есть не во всех репозиториях github.

Есть много популярных сервисов, заменяющих собой абстрацию SKADA систем для этузиастов: Blynk, Home Assistant, ThingSpeak, Cayenne и тд, наверняка есть аналоги в Yandex, Google, Aws облаках. Из минусов, что большинство из них платные и рассчитаны в основном на готовые устройства от крупных компаний, но при этом у них есть поддержка самописных устройств. Но как мне кажется не достаточная в текущих реалиях.

Есть ряд вполне осязаемых вещей, которые хочется видеть.
1. CI/CD - хочется иметь набор абстракций в который помещается ссылка на репозиторий gitlab или github, переменные окружения и в итоге скачать готовый архив с устройством
2. Автоматические обновления - OTA существует, но обычно это самописный модуль, который вечно не работает
3. Полная автономность - ставим инстанс себе в локльную сеть и пользуемся
4. Федеративный поиск - чтобы отдельные инстансы видели друг друга и имели общие списки используемых репозиториев (приватных тут конечно же не будет), но для поиска нужных вам репозиториев

Это не отменят всю мощь Home Assistant или подобных ему решений, но явно упростит жизнь новичкам, энтузиастам и профи.

Вывод по прологу:
1. Автор Энтузиаст
2. Энтузиасту в лице автора мало функционала в готовых решениях

Очень кстати оказалось, что я +- middle python разработчик с некоторым багажом за спиной, я тянул всякое: CRM комбайны, нагруженные вещи и даже немного web3. А что мне как разработчику стоит написать хотябы MVP своих хотелок ?

## Пишем Pepeunit от идеи до 1.0.0 за 2 года в одиночку.
