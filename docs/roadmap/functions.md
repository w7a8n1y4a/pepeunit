# Дорожная карта для Pepeunit

## Анализ динамического состояния узла

1. Анализ общего числа сообщений поступающих на бэкенд
    - mqtt
    - gql
    - rest
    - aiogram
1. Трекер занятости полосы пропускания
1. Трекер физической нагрузки - cpu, ram
1. Место занятое/оставшееся в minio
1. Место занятое/оставшееся в clickhouse
1. Место занятое/оставшееся репозиториями
1. Общее оставшееся место
1. Аптайм
1. Трекер логов приложения уровня error и critical, только частотный анализ, хранение в clickhouse, отчистка 168 часов

## Анализ нагрузки

На эти метрики будет опираться монетизация и настройки пользователей

1. Система отслеживания нагрузки на топики Unit - Расчёт желательно на стороне EMQX
1. Система отслеживания средней нагрузки на один Unit - Метрика загрузки для repo
1. Метрикой должен быть MPS - запросы в секунду
1. Для агрегаций отдельные метрики по занимаемому месту

## Алерты 
1. Ежедневный отчёт по занимаемым ресурсам и аномалиям
1. Ежедневный отчёт по ошибкам администратору, можно отключить при желании
1. Алерты должны быть с дросселировнием, с аналогом частотной аггрегации если это возможно
1. Алерт на объём занимаемой памяти
1. Алерт горячих Unit

## Система бордов

1. Интеграция с Графана, с возможностью авторизовываться через существующий аккаунт
1. Нужны базовые борды для админа - динамическое состояние, анализ нагрузки, трекинг ошибок
1. Нужна привязка агреггированных данных к бордам
    - Таблица Boards в Postgres
    - Кажды борд имеет N ссылок на Unit с включенной агрегацией
    - Для каждого шаблона агрегации есть свой график
    - График конфижится в борд в графане
    - Нужна возможность подписывать графики и шкалы
    - Нужна возможность менять сортировку на борде, чтобы выбирать позиции

## Монетизация для держателей инстансов

1. Подключаемая монетизация на основе Telegram и криптовалют
1. Основана должна быть на нагрузке от Unit, который создаёт юзер
1. Возможность настройки монетизации для администратора
1. Агригируещие топики должны быть монетизированы с другой политикой, т.к. они несут накладные расходы на хранение данных
1. Нужна прогрессивная шкала стоймости MPS и МB у инстансов. По квадратичной функции, 100% нагрузки должны соответствовать бесконечной цене
1. 100% покрытие модульными тестами для кода денег
1. 100% интеграционное покрытие для кода денег

## Система грейдов инстансов

1. Добавить итеративность в проверку нагрузки
1. Добавить хэш в отчёт, чтобы было сложнее его поменять
1. Отчёт по нагрузке должен предоставляться по спец запросу load_limit
1. Число бесплатных MPS
1. Стоймость MPS всверх бесплатных
1. Число бесплатных топиков с агрегацией (нужно придумать метрику)
1. Стоймость за один топик с агрегацией (нужно придумать метрику)
1. Токен доступа для скрапера генерит Админ инстанса

## Федерация

TODO: требуется крепкая проработка

1. Федеративный хаб Repo, c поиском по Unit на мультиинстансе
1. Внедрение activity pub
1. Система взаимодействия между инстансами
1. Проработать activity pub
1. Проработать bridge y emqx, до разных инстансов
1. Белые и чёрные листы доменов для создания repo
1. Импорт экспорт всех данных учётной записи по запросу Пользователя
1. Добавить кнопку обновления env от pepeunit, для будущей возможности переноса Unit на другие инстансы
1. Проработать условия автоматического бана внешних инстансов
1. Нужен бан топиков от внешних инстансов, по условиям (выдумать условия)

## Видео для документации
1. Нужно видео по развёртыванию Pepeunit
1. Нужно видео где с 0 на уже развёрнутом инстансе, создаётся готовая система по существующим Repo - от лица Пользователя
1. Нужно видео где с 0 на уже развёрнутом инстансе, разработчик Unit последовательно создёт новый Unit с 0 - от лица разработчика Unit