# Дорожная карта для Pepeunit

## 0.6.0 Базовый функционал для Telegram
1. repo
    - базовый поиск c возможностью выбрать один из вариантов, c пагинацией
    - просмотр статистик 
    - кнопка обновления Unit
    - синхронизации Repo
    - отдача ссылки на Repo фронтовой
1. unit
    - базовый поиск c возможностью выбрать один из вариантов, c пагинацией
    - просмотр состояния
    - логов c пагинацией
    - возможость вызвать все команды
    - возможность скачать архивы
    - отдача ссылки на Unit фронтовой
    - Просмотр пермишенов
    - возможность открыть UnitNode
    - возможность посмотреть на env файл
1. UnitNode при открытии из unit
    - базовое отображение всех которые есть у Unit c возможностью выбрать один из вариантов, c пагинацией
    - просмотр состояния
    - пермишены
    - отдача ссылки на UnitNode фронтовой
1. Добавить ссылку на графану

## Система агрегации данных

Дать Пользователю создавать временного слушателя mqtt топиков, в идеале внешний сервис на go, а на бек добавить обратную очередь на сохранение:
1. Он бы подписывался на все или часть топиков пользователя
    - на определённое время
    - c ограничением по объёму сохраняемой информации
1. Нужно несколько типов слушателей:
    - долговременные
    - агрегационные со смещающимся окном
    - подумать о возможности динамического размера окна
1. Стратегии сохранения
    - хранятся только данные уже рассчитанные
    - cохранение данных в телегу
    - clickhouse
1. Система собираемых бордов с данными для Graphana и TG интеграции

## Анализ динамического состояния узла

1. Анализ общего числа сообщений поступающих на бэкенд
    - mqtt
    - gql
    - rest
    - aiogram
1. Трекер занятых ресурсов - cpu, ram
1. Оставшееся место
1. Аптайм
1. Трекер ошибок, какие возникают чаще, а какие реже
1. Трекер алерт крашей, с дросселированием - в телегу админу, надо запоминать сколько раз возник

## Анализ нагрузки

На эти метрики будет опираться монетизация и настройки пользователей

1. Система отслеживания нагрузки на топики Unit - Расчёт желательно на стороне EMQX
1. Система отслеживания средней нагрузки на один Unit - Метрика загрузки для repo
1. Метрикой должен быть MPS - запросы в секунду
1. Нужна автоматическая отсечка, если Unit превысил лимиты

## Алерты 
1. Нужно установить начиная с какого уровня лога, будет отправляться alert
1. Дросселирование в телеграм должно работать через Backend, а значит нужна пременная, регламентирующая расстояние между алертами в телеге
1. EMQX должен пересылать алерты на определённый тип ошибок, на основе Rule Engine


## Монетизация для держателей инстансов

1. Подключаемая монетизация на основе Telegram и криптовалют
1. Основана должна быть на нагрузке от Unit, который создаёт юзер
1. Возможность настройки монетизации для администратора
1. Агригируещие топики должны быть монетизированы с другой политикой, т.к. они несут накладные расходы на хранение данных

## Система грейдов инстансов

1. Добавить итеративность в проверку нагрузки
1. Добавить хэш в отчёт, чтобы было сложнее его поменять
1. Отчёт по нагрузке должен предоставляться по спец запросу load_limit
1. Число бесплатных MPS
1. Стоймость MPS всверх бесплатных
1. Число бесплатных топиков с агрегацией (нужно придумать метрику)
1. Стоймость за один топик с агрегацией (нужно придумать метрику)
1. Токен доступа для скрапера генерит Админ инстанса

## Федерация

TODO: требуется крепкая проработка

1. Федеративный хаб Repo, c поиском по Unit на мультиинстансе
1. Внедрение activity pub
1. Система взаимодействия между инстансами
1. Проработать activity pub
1. Проработать bridge y emqx, до разных инстансов
1. Белые и чёрные листы доменов для создания repo
1. Импорт экспорт всех данных учётной записи по запросу Пользователя
1. Добавить кнопку обновления env от pepeunit, для будущей возможности переноса Unit на другие инстансы
1. Проработать условия автоматического бана внешних инстансов
1. Нужен бан топиков от внешних инстансов, по условиям (выдумать условия)

## Видео для документации
1. Нужно видео по развёртыванию Pepeunit
1. Нужно видео где с 0 на уже развёрнутом инстансе, создаётся готовая система по существующим Repo - от лица Пользователя
1. Нужно видео где с 0 на уже развёрнутом инстансе, разработчик Unit последовательно создёт новый Unit с 0 - от лица разработчика Unit