# Дорожная карта для Pepeunit

## Функционал который будет вынесен в Feture Flag

1. Интеграция с Telegram ботом
1. Федерация + Анализ нагрузки
1. Монетизация
1. Агрегация данных - внешние приложения для хранения структурированных данных

## Улучшения бэкенда до многопоточности

1. Сделать через функцию хэширования по наименованию топиков распределение на N потоков
1. Подписка на mqtt должна быть только в распределяющем потоке
1. Пуллинг только в 1 из потоков
1. Настройки брокера только в 1 из потоков
1. Изменить структуру кэша, на локальный внутри потоков, с временем жизни отдельных элементов
1. Сделать утилиту нагрузки, в разных сценариях, консольную, с выдачей отчёта

## Дросселирование MQTT сообщений через настройки EMQX

1. Для domain.com/+/+/+/pepeunit 1 сообщение в секунду
1. Для domain.com/+/pepeunit - 1 сообщение в секунду
1. Для остальных паттернов - 10 сообщений в секунду

## Реализация перехода между версиями и бэкапов

1. Придумать флаги обновлений для генератора .env.services файлов
1. Создание бэкапов перед обновлением
1. Создание бэкапов по команде

## Логирование и алертинг для Unit

1. Стандартный топик log/pepeunit
1. debug, info, warning, error, critical
1. Нужна стандартная переменная окружения в env.json, указывающая какой уровень логирования будет отправляться в log/pepeunit
1. Нужно установить начиная с какого уровня лога, будет отправляться alert
1. Нужно установить стандартное время жизни лога - по умолчанию 86400
1. Складывать логи в clickhouse
1. clickhouse должен позволять делать запросы на выборку всех логов конкретного устройства, например по названию топика логов
1. EMQX должен пересылать алерты на определённый тип ошибок, на основе Rule Engine
1. Дросселирование в телеграм должно работать через Backend, а значит нужна пременная, регламентирующая расстояние между алертами в телеге 

## Анализ нагрузки

1. Внедрение динамических Метрик состояния для Backend
1. Внедрение анализа логов
1. Внедрение статических метрик на основе EMQX
1. Система анализа нагрузки от Unit
1. Система анализа средней нагрузки от Repo - нужно чтобы люди создавая новый Repo, знали сколько и чего он будет кушать
1. Добавить возможность итеративной проверки нагрузки, чтобы получить цифры, доступных лимитов у инстанса
1. Система грейдов инстансов, по нагрузке которую они способны держать
1. Пятиугольник состояния инстанса, сколько нагрузки он ещё способен выдержать

## Монетизация

1. Подключаемая монетизация на основе Telegram и криптовалют
1. Основана должна быть на нагрузке от Unit, который создаёт юзер
1. Возможность настройки монетизации для администратора

## Система агрегации данных

1. Аггрегация данных через внешнее хранилище
1. Такие топики должны быть монетизированы с другой политикой

## Федерация

1. Федеративный хаб Repo, c поиском по Unit на мультиинстансе
1. Поиск должен поддерживаться только для доверенных узлов из белых списков и/или без доменов из чёрного
1. Для каждого Repo указывается стоймость со стандартными устройствами
1. Система взаимодействия между инстансами
1. Проработать activity pub
1. Проработать взаимодействие различных инстансов
1. Проработать bridge y emqx, до разных инстансов
1. Белые и чёрные листы доменов для создания repo
1. Импорт экспорт всех данных учётной записи по запросу Пользователя

## Базовый функционал для Telegram
1. Написать интеграцию с телеграм - для охвата мобильных устройств
1. Статистики использования инстанса, сколько было создано Repo и тд

## Видео для документации
1. Нужно видео по развёртыванию Pepeunit
1. Нужно видео где с 0 на уже развёрнутом инстансе, создаётся готовая система по существующим Repo - от лица Пользователя
1. Нужно видео где с 0 на уже развёрнутом инстансе, разработчик Unit последовательно создёт новый Unit с 0 - от лица разработчика Unit

## Функциоанл на уровне обсуждения
1. Система собираемых бордов с данными для Graphana и TG интеграции