# 0.9.0 Система бордов

## Автоматическая авторизация при переходе по ссылке на grafana
1. oauth в целом работает, но надо научить его работать по сгенерированному jwt. Т.е. ссылке на графану, с упакованным в неё jwt от сервиса pepeunit
    - нужно добавить env переменную в бек, чтобы он знал путь до графана
    - нужно добавить генератор jwt только для grafana, по аналогии с backend, который используется между сервисами
    - нужна ручка, которая по параметрам запроса, сгенерирует jwt для графаны. Параметры зависят от реализации первичной авторизации

## Отображение данных из DataPipe

### Шаблоны графиков
- Добавляются шаблоны графиков, в зависимости от типа хранимых данных и типа агрегации
- Только предварительно созданные, давать возможность создавать их - очень не тревиальная задача

Для всех последних значений:
1. SingleStat / Stat panel — для вывода последнего значения
1. Gauge - измеритель скорости
1. Text - просто текст

Для чисел:
1. Line chart (линейный график) - для Avg/Min/Max/Sum значений с указанием периода (time_window_size) в легенде или цветом.
1. Bar Chart (линейный график) - по сути то же самое что и Line Chart
1. Heat Map - для визуализации плотности значений во времени (например температура по часам суток за неделю).
1. SingleStat / Stat panel — для вывода последнего значения

Для текста + чисел:
1. Logs - отображает текста построчно
1. StateTimeline - отображает текст в виде графика
1. Status History - отображает текст в виде графика
1. Table - отображает текст построчно

### Datasource
Нужна ручка на бекенде, которая бы позволяла по логину присылаемому от графана, отдавать данные по конкретному UnitNode, используя систему доступов Pepeunit

- Реализацию надо делать на основе бекенд datasource, и при этом много тестить как несколько датасурсов работают с одним графиком (шаблоном) или визуализацией как это в доке графаны описано

### Линковка шаблона, UnitNodes в Dashboard на стороне pepeunit
Dashboard содержит шаблоны, а шаблоны работают с datasource на основе данных из UnitNodes. Валидация нужна для корректного отображения ошибок

1. Сначала создаётся сущность dashboard в pepeunit c уникальным именем на узле
1. Потом идёт выбор UnitNode
1. Затем для выбранного UnitNode выбирается шаблон из доступных на основе настроек конвейера
1. Нажимается кнопка создать график
1. В график можно добавить ещё один UnitNode, поиск ищет, но перед добавлением, должна быть проверка

### Модальное окно бордов
1. Имя борда
1. Линк на дешборд если синхронизация прошла успешно
1. Нужен статус синхроназации с ошибкой если есть + время желательно
1. Интерфейс линковки шаблонов
1. Зелёная кнопка - кнопка синхронизации dashboard из pepeunit в grafana
1. Синхронизация работает в 1 сторону, старый борд должен затираться, даже если он был изменён пользователем
1. uuid борда или аналог храним в бд pepeunit

### Settings/Visible - настройка уровня видимости в открыве от изменения самого борда
1. Отдельный статус и ошибка если есть + время
1. Уровень видимости:
    - pulic - кто-угодно, но мод только Viewer
    - Internal - любой на инстансе, мод только Viewer
    - private - только создатель и тот кому доверили, мод Modifer - это позволит сделать борд изменяемым
1. Отдельно от Options, т.к. настроить размеры графиков можно будет только в private

### Settings/Delete - настройка уровня видимости в открыве от изменения самого борда
1. Кнопка удаления борда как обычно

### Реестр бордов
1. Поиск по своим dashboard, по именам
1. Создание как у Реестра репозиториев
1. Отображение как у реестра репозиториев, но кнопки в таблице надо 2:
    - первая на модалку
    - вторая на переход в дешборд

## Борды Администратора

- Доступ токо с ролью Admin на инстансе pepeunit.
- В графане доступ только Viewer

Какие борды нужны первично:
1. Существующий борд на основе прометиуса бекенда
    - Время запросов + процентили (есть и работает)
    - Как-то заставить работать Memory usage
    - Как-то заставить работать CPU usage
    - Errors per second просто удалить
1. Борд на основе EMQX и его прометиуса
    - Можно дефолтный который у них на странице, видимо надо разобраться как добавить ещё один конфиг в prometheus
1. Логи Backend
    - очень нужно видеть число возникновений каждой ошибки, в идеале видеть не только текст, но и стектрейс хотябы первой возникшей с таким текстом
    - при этом ошибки нужны за 1 неделю, больше нет смысла
    - под эту задачу видимо надо затягивать на проект ещё одну зависимость

## Импорт данных по шаблону

Возможность импортировать уже существующие данные в систему, формат нужно проверять в оответствии с текущими настройками DataPipe

Эта функция сделает систему гараздо актуальнее, наверняка данные кто-то собирает уже давно
