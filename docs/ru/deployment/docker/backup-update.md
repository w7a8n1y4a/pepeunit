# Бэкапы и обновление

## Работа с бэкапами

### Создание бэкапа
1. Запустите `Pepeunit`, чтобы скрипт `backup` имел доступ до баз данных и версии `backend`
    ```bash
    docker compose up -d
    ```
1. Запустите создание `backup`, не прерывая работу контейнеров
    ```bash
    sudo ./backup.sh backup
    ```

### Восстановление из бэкапа
1. Выключите инстанс
    ```bash
    docker compose down
    ```
1. Разверните версию из `backup`
    ```bash
    sudo ./backup.sh restore backups/backup_name.tar
    ```
1. Запустите `Pepeunit`
    ```bash
    docker compose up -d
    ```

## Обновление

1. Создайте `backup`
    ```bash
    sudo ./backup.sh backup
    ```
1. Выполните обновление репозитория
    ```bash
    git pull
    ```
1. Выполните обновление `env` переменных. Существующие секретные `32-битные ключи` изменены не будут. Остальные переменные будут сгенерированы, как при первой генерации. Если вы выполняли ручной ввод данных в `env/.env.<service-name>` файлы, то ваши изменения будут **УДАЛЕНЫ**, поэтому обязательно делайте `backup` перед запуском команды. Если у вас очень тонкая настройка, изменяйте настройки вручную путем изменения файлов в `env/.env.<service-name>`.
    ```bash
    python make_env.py
    ```
1. Выполните запуск `Pepeunit`
    ```bash
    docker compose up -d
    ```