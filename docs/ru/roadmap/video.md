# Обзор на pepeunit

Цель: после просмотра, народ должен понять что такое pepeunit, как в нём можно создать свои Unit пользователям и разработчикам, какой результат можно получить за минимум усилий

## Интро

1. Анимированное в техническом стиле похожем на Aperture labs, но своё - Opensource - AGPLv3 и тд

## Вступление

Страдаете создавая код для iot устройств?
Постоянно переделываете чужой код под себя?
Прилагаете значительные усилия чтобы получить простой сенсор или актор ?
Вам тяжело воспринимать чужой код ?
У вас есть идеи распределённых и комбинированных устройств, но их тяжело их масштабировать ?

Pepepunit вам поможет.

Сделаем iot стриминг mp4 видео, на маленькие oled экранчики

Наша цель на всё оставшееся видео - затратить минимум усилий и увидеть реализацию стриминга от а до я, со стороны обычного пользователя, который ещё очень мало знаком с IoT миром, но уже хочет попробовать создать качественные устройства

## Смотрим репы

Основа любого распределённого iot устройства, это git репозитории.

В нашем случае их будет два, серверное и конечное устройство ввода вывода

1. Конечное устройство, открываем реп и показываем схему - esp32s3/c3 mini + oled экран
1. Серверное, мб схема движения данных - телеграм бот управления контентом

Оба репозитория собраны на основе клиентских библиотек pepeunit и имеют специальную структуру, чтобы стать Unit`ами внутри инстанса Pepeunit

## Создаём физическую часть

Посмотрели репозитории, можно сразу спаять конечные устройства, 

Паяем 3-4 oleda быстро под музычку

1 из них с энекодером, другие без энкодеров

показать что могут ff_

## Создаём абстракции

Физически всё готово, теперь нужно настроить взаимодействие.

Берём ссылки на репозитории и создаём Registry в Pepeunit, если их конечно не создали до нас

1. Создадим общий Repo для группы oled устройств, чтобы управлять обновлением, всех 4 экранов через одну сущность
1. Создадим Unit для экранов.
1. Создадим Repo для серверного репозитория
1. Создадим серверный Unit

## Схема взаимодействия

Unit созданы, но они ещё не знают друг о друге

1. Нужно настроить взаимодейтсвие mqtt топиков
1. Смотрим в репы и читаем
1. Заходим в каждый unit и ставим в input - output от серверного Unit

## Настраиваем env для устройств

Unit знают друг о друге, но у них ещё нет личности, Pepeunit не сможет отличить их

1. Заполним env у каждого из устройств
1. Смотрим в репы и читаем
1. Заполняем

## Заливаем код на устройства

В вебе всё сделали, осталось залить код на устройства

Скачиваем архивы, и распаковывем

Применяем esptool и ampy заливаем на esp

Просто запускаем python скрипт и всё для сервера

## Смотрим как работает стриминг

Загружаем видос через телегу, нажимаем обработку в телеге или кликаем encoder

Параллельно идёт видик с камеры

## Бонус

Завязываем одну из команд серевера на hotkey bublik, чтобы по хоткею свапать видики или вообще управлять

## Конец

Пролётка уже с корпусом.

За буквально 1 вечер, мы собрали рабочий стриминг с 4 устройствами с полного нуля, при этом мы имеем два канала управления этим стримингом
Мы вообще не взаимодейтствовали с кодом, потому что мы воспользовались готовыми репозиториями от других разработчиков


Если вы разработчик IoT устройств у вас всегда есть возможность предложить mr в такой репозиторий или вообще сделать fork.

Чтобы превратить любой репозиторий c кодом в Unit достаточно добавить в него 4 файла:

1. env_example.json
1. schema_example.json
1. pepeunit.toml

Pepeunit не привязан к конкретному языку программирования, или платформе развёртывания.

Pepeunit умеет значительно больше на данный момент, например: сценарии обработки данных и их визуализация в grafana. C полным функционалом вы можете ознакомиться на сайте pepeunit.com, там представлена полная документация на ru и en

Оставайтесь на связи, будем делать IoT удобнее.

## Контент

1. obs интерфейсов
1. obs документации
1. obs + cam как управляется через hotkey bublik
1. cam печати 3d моделей
1. cam сборки устройств
1. cam работы устройств
1. cam работы системы в целом

## Сценарий

1. Начинается с абсолютно пустого инстанса
1. Создаётся Unit`ы в pepeunit из ссылок на гит репозитории
    - 3 реле
    - 1 hotkey bublik
1. Физическое создание Unit
    - пайка
    - корпусирование
1. Программная настройка бублика
    - комнады с разными параметрами
    - хоткеи
1. Настройка дата пайпов
1. Настройка визуализаций в grafana
